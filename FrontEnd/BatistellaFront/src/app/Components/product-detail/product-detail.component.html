<div class="container mx-auto px-3 py-5">
  <!-- Indicador de carga -->
  <div *ngIf="isLoading" class="text-center py-16">
    <div class="mx-auto h-10 w-10 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"></div>
    <p class="mt-2 text-gray-600">Cargando producto...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded mb-3">
    {{ errorMessage }}
    <a routerLink="/" class="ml-2 text-red-700 hover:text-red-900 underline">Volver al inicio</a>
  </div>

  <!-- Mensaje de éxito -->
  <div *ngIf="showSuccessMessage" class="fixed top-4 right-4 z-50 bg-green-100 border border-green-400 text-green-700 px-3 py-2 rounded-md shadow-lg animate-fade-in">
    <div class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <span>{{ successMessage }}</span>
    </div>
  </div>

  <!-- Detalle del producto -->
  <div *ngIf="!isLoading && product" class="bg-white rounded-lg overflow-hidden md:grid md:grid-cols-12 gap-0">
    <!-- Migas de pan -->
    <div class="col-span-12 p-3">
      <div class="flex items-center text-xs text-gray-500 mb-3">
        <a routerLink="/" class="hover:text-blue-500">Inicio</a>
        <span class="mx-1">›</span>
        <a [routerLink]="'/category/' + product.animalType" class="hover:text-blue-500">{{ product.animalType }}</a>
        <span class="mx-1">›</span>
        <a [routerLink]="'/alimento'" class="hover:text-blue-500">Alimentos</a>
        <span class="mx-1">›</span>
        <span class="text-gray-700">{{ product.marca }}</span>
      </div>
    </div>

    <!-- Imagen del producto -->
    <div class="col-span-12 md:col-span-7 p-4">
      <div class="w-full">
        <div class="relative pb-[75%] overflow-hidden">
          <img 
            [src]="product.imageUrl" 
            [alt]="product.fullName"
            class="absolute inset-0 w-full h-full object-contain"
          />
        </div>
      </div>
      
      <!-- Descripción del producto -->
      <div class="mt-4">
        <h2 class="text-lg font-medium mb-3">Descripción</h2>
        <div class="text-gray-700 text-sm">
          <p class="mb-2">{{ product.description || 'Alimento balanceado completo para su mascota, formulado con nutrientes esenciales para mantener su salud y bienestar.' }}</p>
          
          <div class="mt-4">
            <h3 class="text-base font-medium mb-2">Características del producto</h3>
            <ul class="space-y-2">
              <li class="flex">
                <span class="text-gray-700 mr-2">•</span>
                <span>Tipo de alimento: {{ product.tipoAlimento }}</span>
              </li>
              <li class="flex">
                <span class="text-gray-700 mr-2">•</span>
                <span>Tamaño de la raza: {{ product.tipoRaza || 'Todo tipo de razas' }}</span>
              </li>
              <li class="flex">
                <span class="text-gray-700 mr-2">•</span>
                <span>Peso: {{ product.kg }}</span>
              </li>
              <li class="flex">
                <span class="text-gray-700 mr-2">•</span>
                <span>Marca: {{ product.marca }}</span>
              </li>
              <li class="flex">
                <span class="text-gray-700 mr-2">•</span>
                <span>Tipo de mascota: {{ product.animalType }}</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Información del producto -->
    <div class="col-span-12 md:col-span-5 p-4 border-l border-gray-200 flex flex-col">
      <!-- Etiquetas -->
      <div class="mb-1">
        <span class="text-xs text-gray-500">Nuevo</span>
      </div>
      
      <!-- Nombre del producto -->
      <h1 class="text-lg font-normal text-gray-800 mb-3">{{ product.fullName }}</h1>
      
      <!-- Aviso de stock bajo -->
      <div *ngIf="product.stock < 10" class="mb-3">
        <span class="text-orange-500 font-medium text-sm">¡Últimas {{ product.stock }} unidades!</span>
      </div>
      
      <!-- Precios -->
      <div class="mb-4">
        <div class="flex items-center">
          <span class="text-3xl font-light">$ {{ Math.floor(product.priceMinorista).toLocaleString('es-AR') }}</span>
          <span class="text-base ml-0.5">{{ (product.priceMinorista % 1 > 0 ? Math.round((product.priceMinorista % 1) * 100) : '00') }}</span>
        </div>
      </div>

      <!-- Opciones de peso -->
      <div class="mb-4">
        <span class="text-xs font-medium mb-1 block">Peso</span>
        <div class="flex gap-2">
          <button class="border px-3 py-1 rounded font-normal text-xs hover:border-blue-500" [class.border-blue-500]="product.kg === '3kg'">3kg</button>
          <button class="border px-3 py-1 rounded font-normal text-xs hover:border-blue-500" [class.border-blue-500]="product.kg === '8kg'">8kg</button>
          <button class="border px-3 py-1 rounded font-normal text-xs hover:border-blue-500" [class.border-blue-500]="product.kg === '15kg'">15kg</button>
        </div>
      </div>
      
      <!-- Stock y cantidad -->
      <div class="mb-4">
        <span class="text-xs font-medium mb-1 block">Cantidad</span>
        <div class="flex items-center">
          <div class="flex items-center border border-gray-300 rounded-md">
            <button 
              (click)="decrementQuantity()" 
              class="px-2 py-0.5 text-gray-600 hover:bg-gray-100"
              [disabled]="quantity <= 1"
            >−</button>
            <input 
              type="number" 
              [(ngModel)]="quantity" 
              min="1" 
              [max]="product.stock" 
              class="w-12 text-center border-none focus:outline-none focus:ring-0 p-0 text-sm"
            />
            <button 
              (click)="incrementQuantity()" 
              class="px-2 py-0.5 text-gray-600 hover:bg-gray-100"
              [disabled]="quantity >= product.stock"
            >+</button>
          </div>
          <span class="ml-2 text-xs text-gray-600">
            ({{ product.stock }} disponibles)
          </span>
        </div>
      </div>
      
      <!-- Medios de pago -->
      <div class="mb-4">
        <span class="text-xs font-medium mb-1 block">Medios de pago</span>
        <div class="flex items-center">
          <div class="flex items-center border border-gray-300 rounded-md px-2 py-1.5">
            <svg class="h-4 w-4 text-sky-500 mr-1" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm.35 15.5c-3.58 0-6.5-2.92-6.5-6.5s2.92-6.5 6.5-6.5 6.5 2.92 6.5 6.5-2.92 6.5-6.5 6.5z"/>
            </svg>
            <span class="text-sky-500 font-medium text-xs">Mercado Pago</span>
          </div>
        </div>
      </div>
      
      <!-- Botones de acción -->
      <div class="mb-4">
        <button 
          (click)="addToCart()"
          class="mb-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-md flex items-center justify-center transition duration-150 text-sm"
          [disabled]="product.stock <= 0"
        >
          Agregar al carrito
        </button>
        <button 
          class="w-full bg-blue-100 text-blue-700 border border-blue-700 py-2 px-3 rounded-md flex items-center justify-center transition duration-150 hover:bg-blue-200 text-sm"
          [disabled]="product.stock <= 0"
        >
          Comprar ahora
        </button>
      </div>
    </div>

    <!-- Secciones colapsables -->
    <div class="col-span-12 px-4 py-2 border-t border-gray-200">
      <div class="accordion">
        <!-- Devoluciones -->
        <div class="border-b border-gray-200 py-2">
          <div class="flex justify-between items-center cursor-pointer" (click)="toggleAccordion('devoluciones')">
            <h3 class="text-sm font-medium">DEVOLUCIONES</h3>
            <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor" 
                 [class.transform]="accordionState.devoluciones" 
                 [class.rotate-180]="accordionState.devoluciones">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div [class.hidden]="!accordionState.devoluciones" class="mt-1 text-gray-700 text-xs">
            <p>Tenés 30 días desde que recibís el producto para devolverlo. ¡Siempre pagamos el envío de vuelta!</p>
          </div>
        </div>

        <!-- Envíos a domicilio -->
        <div class="border-b border-gray-200 py-2">
          <div class="flex justify-between items-center cursor-pointer" (click)="toggleAccordion('envios')">
            <h3 class="text-sm font-medium">ENVÍOS A DOMICILIO</h3>
            <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor" 
                 [class.transform]="accordionState.envios" 
                 [class.rotate-180]="accordionState.envios">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div [class.hidden]="!accordionState.envios" class="mt-1 text-gray-700 text-xs">
            <p>Conocé los tiempos y las formas de envío.</p>
            <p class="mt-1">Envío gratis en compras mayores a $20.000</p>
          </div>
        </div>

        <!-- Retiro en depósito -->
        <div class="border-b border-gray-200 py-2">
          <div class="flex justify-between items-center cursor-pointer" (click)="toggleAccordion('retiro')">
            <h3 class="text-sm font-medium">RETIRO EN DEPÓSITO</h3>
            <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor" 
                 [class.transform]="accordionState.retiro" 
                 [class.rotate-180]="accordionState.retiro">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div [class.hidden]="!accordionState.retiro" class="mt-1 text-gray-700 text-xs">
            <p>Podés retirar tu compra en nuestro depósito de lunes a viernes de 9 a 18hs.</p>
            <p class="mt-1">Dirección: Av. Colón 5050, Córdoba Capital</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 