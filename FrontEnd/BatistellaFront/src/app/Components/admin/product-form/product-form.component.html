<div class="container mx-auto p-4 max-w-3xl">
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">
      {{ isEditing ? 'Editar Producto' : 'Agregar Nuevo Producto' }}
    </h1>
    <p class="text-gray-500 mt-1">
      Completa los campos para {{ isEditing ? 'actualizar el' : 'crear un nuevo' }} producto
    </p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    {{ errorMessage }}
  </div>

  <!-- Mensaje de éxito -->
  <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
    {{ successMessage }}
  </div>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="bg-white shadow-md rounded-lg p-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Marca -->
      <div class="form-group">
        <label for="marca" class="block text-sm font-medium text-gray-700 mb-1">Marca *</label>
        <select
          id="marca"
          formControlName="marca"
          class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md"
          [ngClass]="{'border-red-500': productForm.get('marca')?.invalid && productForm.get('marca')?.touched}"
        >
          <option value="" disabled>Selecciona una marca</option>
          <option *ngFor="let option of marcaOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        <div 
          *ngIf="productForm.get('marca')?.invalid && productForm.get('marca')?.touched" 
          class="text-red-500 text-xs mt-1"
        >
          La marca es obligatoria
        </div>
      </div>

      <!-- Tipo de Alimento -->
      <div class="form-group">
        <label for="tipoAlimento" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Alimento *</label>
        <select
          id="tipoAlimento"
          formControlName="tipoAlimento"
          class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md"
          [ngClass]="{'border-red-500': productForm.get('tipoAlimento')?.invalid && productForm.get('tipoAlimento')?.touched}"
        >
          <option value="" disabled>Selecciona un tipo</option>
          <option *ngFor="let option of tipoAlimentoOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        <div 
          *ngIf="productForm.get('tipoAlimento')?.invalid && productForm.get('tipoAlimento')?.touched" 
          class="text-red-500 text-xs mt-1"
        >
          El tipo de alimento es obligatorio
        </div>
      </div>

      <!-- Tipo de Raza -->
      <div class="form-group">
        <label for="tipoRaza" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Raza</label>
        <select
          id="tipoRaza"
          formControlName="tipoRaza"
          class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md"
        >
          <option value="">Ninguno</option>
          <option *ngFor="let option of tipoRazaOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Tamaño (kg) -->
      <div class="form-group">
        <label for="kg" class="block text-sm font-medium text-gray-700 mb-1">Tamaño (kg) *</label>
        <select
          id="kg"
          formControlName="kg"
          class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md"
          [ngClass]="{'border-red-500': productForm.get('kg')?.invalid && productForm.get('kg')?.touched}"
        >
          <option value="" disabled>Selecciona un tamaño</option>
          <option *ngFor="let option of kgOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        <div 
          *ngIf="productForm.get('kg')?.invalid && productForm.get('kg')?.touched" 
          class="text-red-500 text-xs mt-1"
        >
          El tamaño es obligatorio
        </div>
      </div>

      <!-- Precio Minorista -->
      <div class="form-group">
        <label for="priceMinorista" class="block text-sm font-medium text-gray-700 mb-1">Precio Minorista *</label>
        <div class="mt-1 relative rounded-md shadow-sm">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <span class="text-gray-500 sm:text-sm">$</span>
          </div>
          <input
            type="number"
            id="priceMinorista"
            formControlName="priceMinorista"
            class="focus:ring-teal-500 focus:border-teal-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
            [ngClass]="{'border-red-500': productForm.get('priceMinorista')?.invalid && productForm.get('priceMinorista')?.touched}"
            placeholder="0.00"
            min="0"
            step="0.01"
          >
        </div>
        <div 
          *ngIf="productForm.get('priceMinorista')?.invalid && productForm.get('priceMinorista')?.touched" 
          class="text-red-500 text-xs mt-1"
        >
          <span *ngIf="productForm.get('priceMinorista')?.errors?.['required']">El precio minorista es obligatorio</span>
          <span *ngIf="productForm.get('priceMinorista')?.errors?.['min']">El precio debe ser mayor o igual a 0</span>
        </div>
      </div>

      <!-- Precio Mayorista -->
      <div class="form-group">
        <label for="priceMayorista" class="block text-sm font-medium text-gray-700 mb-1">Precio Mayorista *</label>
        <div class="mt-1 relative rounded-md shadow-sm">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <span class="text-gray-500 sm:text-sm">$</span>
          </div>
          <input
            type="number"
            id="priceMayorista"
            formControlName="priceMayorista"
            class="focus:ring-teal-500 focus:border-teal-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
            [ngClass]="{'border-red-500': productForm.get('priceMayorista')?.invalid && productForm.get('priceMayorista')?.touched}"
            placeholder="0.00"
            min="0"
            step="0.01"
          >
        </div>
        <div 
          *ngIf="productForm.get('priceMayorista')?.invalid && productForm.get('priceMayorista')?.touched" 
          class="text-red-500 text-xs mt-1"
        >
          <span *ngIf="productForm.get('priceMayorista')?.errors?.['required']">El precio mayorista es obligatorio</span>
          <span *ngIf="productForm.get('priceMayorista')?.errors?.['min']">El precio debe ser mayor o igual a 0</span>
        </div>
      </div>

      <!-- Stock -->
      <div class="form-group">
        <label for="stock" class="block text-sm font-medium text-gray-700 mb-1">Stock *</label>
        <input
          type="number"
          id="stock"
          formControlName="stock"
          class="mt-1 focus:ring-teal-500 focus:border-teal-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
          [ngClass]="{'border-red-500': productForm.get('stock')?.invalid && productForm.get('stock')?.touched}"
          placeholder="Cantidad disponible"
          min="0"
          step="1"
        >
        <div 
          *ngIf="productForm.get('stock')?.invalid && productForm.get('stock')?.touched" 
          class="text-red-500 text-xs mt-1"
        >
          <span *ngIf="productForm.get('stock')?.errors?.['required']">El stock es obligatorio</span>
          <span *ngIf="productForm.get('stock')?.errors?.['min']">El stock debe ser mayor o igual a 0</span>
        </div>
      </div>

      <!-- Tipo de Animal -->
      <div class="form-group">
        <label for="animalType" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Animal *</label>
        <select
          id="animalType"
          formControlName="animalType"
          class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md"
          [ngClass]="{'border-red-500': productForm.get('animalType')?.invalid && productForm.get('animalType')?.touched}"
        >
          <option value="" disabled>Selecciona un tipo</option>
          <option *ngFor="let option of animalTypeOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        <div 
          *ngIf="productForm.get('animalType')?.invalid && productForm.get('animalType')?.touched" 
          class="text-red-500 text-xs mt-1"
        >
          El tipo de animal es obligatorio
        </div>
      </div>

      <!-- Estado Activo -->
      <div class="form-group col-span-1 md:col-span-2">
        <div class="flex items-center">
          <input
            id="activo"
            formControlName="activo"
            type="checkbox"
            class="h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded"
          >
          <label for="activo" class="ml-2 block text-sm text-gray-900">
            Activo (disponible para la venta)
          </label>
        </div>
      </div>
    </div>

    <!-- Descripción -->
    <div class="form-group mt-6">
      <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
      <textarea
        id="description"
        formControlName="description"
        rows="3"
        class="shadow-sm focus:ring-teal-500 focus:border-teal-500 mt-1 block w-full sm:text-sm border-gray-300 rounded-md"
        placeholder="Descripción del producto..."
      ></textarea>
    </div>

    <!-- Imagen del producto -->
    <div class="form-group mt-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">
        Imagen del Producto {{ isEditing ? '' : '*' }}
      </label>
      
      <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
        <div class="space-y-1 text-center">
          <!-- Vista previa de la imagen -->
          <div *ngIf="imagePreview" class="mb-3">
            <img [src]="imagePreview" alt="Vista previa" class="mx-auto h-32 object-contain">
          </div>
          
          <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          
          <div class="flex text-sm text-gray-600">
            <label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-teal-600 hover:text-teal-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-teal-500">
              <span>Subir un archivo</span>
              <input 
                id="file-upload" 
                name="file-upload" 
                type="file" 
                class="sr-only"
                accept="image/*"
                (change)="onFileSelected($event)"
              >
            </label>
            <p class="pl-1">o arrastra y suelta</p>
          </div>
          <p class="text-xs text-gray-500">
            PNG, JPG, GIF hasta 10MB
          </p>
        </div>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="flex justify-end space-x-3 mt-8">
      <a 
        routerLink="/admin/products" 
        class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500"
      >
        Cancelar
      </a>
      <button 
        type="submit" 
        class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500"
        [disabled]="isSubmitting"
      >
        <div *ngIf="isSubmitting" class="mr-2 animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></div>
        {{ isEditing ? 'Actualizar' : 'Crear' }} Producto
      </button>
    </div>
  </form>
</div> 